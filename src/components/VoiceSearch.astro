---
// Componente de bÃºsqueda por voz
interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<div class={`voice-search-container ${className}`}>
  <button
    type="button"
    id="voiceSearchBtn"
    class="btn-large inline-flex items-center gap-3 px-8 py-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:ring-4 focus:ring-purple-300 transition-colors font-bold text-xl shadow-lg"
    aria-label="Buscar por voz"
  >
    <span class="text-3xl" aria-hidden="true">ðŸŽ¤</span>
    <span>Buscar por Voz</span>
  </button>
  
  <div id="voiceStatus" class="mt-4 text-center text-lg font-semibold" role="status" aria-live="polite"></div>
</div>

<script>
  import { speechRecognize } from '../lib/speech';

  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('voiceSearchBtn');
    const status = document.getElementById('voiceStatus');

    if (btn && status) {
      btn.addEventListener('click', () => {
        status.textContent = 'Escuchando... ðŸŽ¤';
        status.className = 'mt-4 text-center text-lg font-semibold text-purple-600';

        speechRecognize(
          (text) => {
            status.textContent = `Escuchado: "${text}"`;
            status.className = 'mt-4 text-center text-lg font-semibold text-green-600';
            
            // Redirigir a la pÃ¡gina de bÃºsqueda
            setTimeout(() => {
              window.location.href = `/buscar-client?q=${encodeURIComponent(text)}`;
            }, 1000);
          },
          (error) => {
            status.textContent = `Error: ${error}`;
            status.className = 'mt-4 text-center text-lg font-semibold text-red-600';
            
            setTimeout(() => {
              status.textContent = '';
            }, 3000);
          }
        );
      });
    }
  });
</script>
