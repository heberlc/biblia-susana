---
import Layout from "../../layouts/Layout.astro";
import { loadBible } from "../../lib/loadBible";
import type { Libro } from "../../types/bible";

// Generar rutas est치ticas para todos los libros
export async function getStaticPaths() {
  const biblia = await loadBible();
  
  return biblia.libros.map((libro) => ({
    params: { nombre: libro.nombre },
  }));
}

// Obtener el nombre del libro de la URL
const { nombre } = Astro.params;

let libro: Libro | undefined;
let error = false;

try {
  const biblia = await loadBible();
  libro = biblia.libros.find(l => l.nombre === nombre);
} catch (e) {
  console.error('Error al cargar el libro:', e);
  error = true;
}

// Si no se encuentra el libro, mostrar error
if (!libro && !error) {
  return Astro.redirect('/404');
}
---

<Layout 
  title={`${libro?.nombre || 'Libro'} - Biblia Accesible`}
  description={`Cap칤tulos del libro ${libro?.nombre || ''} de la Biblia`}
>
  <div class="max-w-5xl mx-auto">
    <!-- Navegaci칩n -->
    <nav class="mb-8" aria-label="Navegaci칩n">
      <a
        href="/"
        class="inline-flex items-center gap-2 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 transition-colors font-semibold text-lg"
      >
        <span class="text-xl" aria-hidden="true">游</span>
        Volver al Inicio
      </a>
    </nav>

    {error && (
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-6 rounded-lg" role="alert">
        <p class="font-bold text-xl mb-2">Error al cargar el libro</p>
        <p class="text-lg">No se pudo cargar el contenido del libro. Intenta de nuevo.</p>
      </div>
    )}

    {libro && (
      <div>
        <!-- Encabezado del libro -->
        <header class="mb-8 text-center">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-800 dark:text-gray-100 mb-4">
            {libro.nombre}
          </h1>
          <p class="text-xl text-gray-600 dark:text-gray-300">
            {libro.capitulos.length} {libro.capitulos.length === 1 ? 'cap칤tulo' : 'cap칤tulos'}
          </p>
        </header>

        <!-- Lista de cap칤tulos -->
        <section>
          <h2 class="text-3xl font-bold mb-6 text-gray-800 dark:text-gray-100">Cap칤tulos</h2>
          <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
            {libro.capitulos.map((capitulo) => (
              <a
                href={`/libro/${encodeURIComponent(libro.nombre)}/${capitulo.numero}`}
                class="flex items-center justify-center bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hover:shadow-xl hover:scale-110 transition-all border-2 border-transparent hover:border-blue-500 dark:hover:border-blue-400 focus:border-blue-600 focus:ring-4 focus:ring-blue-300"
                aria-label={`Cap칤tulo ${capitulo.numero}`}
              >
                <span class="text-3xl font-bold text-blue-700 dark:text-blue-400">
                  {capitulo.numero}
                </span>
              </a>
            ))}
          </div>
        </section>
      </div>
    )}
  </div>
</Layout>

<style>
  /* Animaci칩n para los botones de cap칤tulos */
  @media (prefers-reduced-motion: no-preference) {
    a {
      animation: fadeIn 0.4s ease-out;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>
